Формат данных
=============

Для того, чтобы каким-либо образом логировать игры нужно было разработать формат в котором их хранить.
А также придумать обозначения, которые стоит использовать, чтобы компактно и быстро записывать речи игроков.

Как формат представления игр было решено взять yaml. Потому что его легко прочитать человеку и достаточно легко распарсить.


Струстура файла
---------------

Файл представляет из себя список yaml-объектов игр:

    - game:
      ...
    - game:
      ...
    ...

Каждый объект-"игра" содержит следующие аттрибуты:
* **club**: клуб в котором проходила игра.
* **place**: место в котором проходила игра.
* **locality**: город в котором проходила игра.
* **date**: дата в формате *YYYY-MM-DD*.
* **players**: список из 10 игроков.
* **roles**: роли в игре. Три объекта: *don*, *maf*, *sheriff*, каждый из которых содержит строку содержащую номер игрока/ов получивших роли.
* **laps**: игровые круги (дни-ночи).


Представление процесса игры
---------------------------

Представление игрового процесса хранится в аттрибуте **laps** в форматесписок из объектов **day**, который заканчивается объектом **end**.

В объекте **end** хранится лишь строка "black" или "red", которая говорит о том какая команда победила.

    - game:
      ...
      laps:
        - day:
          ...
        - day:
          ...
        ...
        - end: red # или black


### День

День представляет из себя объект в котором хранится речей произнесенных этим днем, включая убитого предыдущей ночью игрока, а также ночные действия происходящие после этого дня, речи убиенных днем игроков и голосование.

    - day:
      - 1: ... # речь первого игрока
      - 2: ...
      - ... # речи оставшихся игроков
      voting: # голосования
        ...
      night: 
        shot: 3 # застрелян 3
        don: 2 # дон проверил игрока 2
        sheriff: 3 # шериф проверил 3
      dead:
        - ... # речи убитых на голосовании игроков
      

### Голосование

**voting** содержит список объектов **votes** всех голосований, которые прошли днем. "Всех" потому, что голосований может быть несколько. В объекте **votes** хранится следующие данные:

* Список объектов вида { игрок : кто проголосовал за него } в порядке голосования.
* Может содержать объект **crash** в случае автокатострофы среди нескольких игроков. Речи в автокатострофе записываются аналогично дню.
* В списке голосования может хранится (всегда последним) объект { both: кто проголосовал }. Это голосование за то, чтобы все игроки в автокатострофе покинули игру.

Пример записи голосования:

    voting:        # список голосований
      - votes:     # голосование
        - 5: 6-10  # за игрока 5 проголосовали с 6 по 10 игроки
        - 7: 1-5   # за игрока 7 проголосовали с 1 по 5 игроки
        crash:     # автокатострофа
          - 5: ... # речь игрока в автокатострофе
          - 7: ...
      - votes:     # повторное голосование
        - 5: 6-10
        - 7: 1-5
        - both: 0 # никто не проголосовал за то, чтобы оба игрока покинули игру

#### Как записывать голоса?
Вот грамматика для голосов:

    # terminals
    DDOT = ':'
    COMMA = ','
    DIGIT = '\d+'
    BOTH = 'both'
    EMPTY = ''
    DASH = '-'

    # grammar rules
    VOTE:
        WHOS DDOT HANDS

    WHOS:
        DIGIT
      | BOTH
      | DIGIT COMMA WHOS

    HANDS:
        DIGIT
      | EMPTY
      | DIGIT DASH DIGIT
      | DIGIT HANDS
      | DIGIT COMMA HANDS

Примеры:

    1,2,3,4: 5-9    # за игроков 1 2 3 и 4 проголосовали живые игроки с 5 по 9

    4: 1 3,9        # за игрока 4 проголосовали 1 3 и 9.

    both: 1-10      # за то чтобы поднять всех игроков в перестрелке
                    # проголосовали все живые игроки

#### Быстрая запись

Если голосование было одно, то допускается записывать все что лежит в **votes** прямо в **voting**, например:

    # Вместо
    voting:
      - votes:
        - 3: 4 5
        - 5: 1-3
        - 6,7: 0   # за 6 и 7 никто не проголосовал
        - 2: 6 7

    # Можно писать
    voting:
      - 3: 4 5
      - 5: 1-3
      - 6,7: 0   # за 6 и 7 никто не проголосовал
      - 2: 6 7

Речи игроков
------------

