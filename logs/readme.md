Формат данных
=============

Для того, чтобы каким-либо образом логировать игры нужно было разработать формат в котором их хранить.
А также придумать обозначения, которые стоит использовать, чтобы компактно и быстро записывать речи игроков.

Как формат представления игр было решено взять yaml. Потому что его легко прочитать человеку и достаточно легко распарсить.


Струстура файла
---------------

Файл представляет из себя список yaml-объектов игр:

    - game:
      ...
    - game:
      ...
    ...

Каждый объект-"игра" содержит следующие аттрибуты:
* **club**: клуб в котором проходила игра.
* **place**: место в котором проходила игра.
* **locality**: город в котором проходила игра.
* **date**: дата в формате *YYYY-MM-DD*.
* **players**: список из 10 игроков.
* **roles**: роли в игре. Три объекта: *don*, *maf*, *sheriff*, каждый из которых содержит строку содержащую номер игрока/ов получивших роли.
* **laps**: игровые круги (дни-ночи).


Представление процесса игры
---------------------------

Представление игрового процесса хранится в аттрибуте **laps** в форматесписок из объектов **day**, который заканчивается объектом **end**.

В объекте **end** хранится лишь строка "black" или "red", которая говорит о том какая команда победила.

    - game:
      ...
      laps:
        - day:
          ...
        - day:
          ...
        ...
        - end: red # или black


### День

День представляет из себя объект в котором хранится речей произнесенных этим днем, включая убитого предыдущей ночью игрока, а также ночные действия происходящие после этого дня, речи убиенных днем игроков и голосование.

    - day:
      - 1: ... # речь первого игрока
      - 2: ...
      - ... # речи оставшихся игроков
      voting: # голосования
        ...
      night: 
        shot: 3 # застрелян 3
        don: 2 # дон проверил игрока 2
        sheriff: 3 # шериф проверил 3
      dead:
        - ... # речи убитых на голосовании игроков
      

### Голосование

**voting** содержит список объектов **votes** всех голосований, которые прошли днем. "Всех" потому, что голосований может быть несколько. В объекте **votes** хранится следующие данные:

* Список объектов вида { игрок : кто проголосовал за него } в порядке голосования.
* Может содержать объект **crash** в случае автокатострофы среди нескольких игроков. Речи в автокатострофе записываются аналогично дню.
* В списке голосования может хранится (всегда последним) объект { both: кто проголосовал }. Это голосование за то, чтобы все игроки в автокатострофе покинули игру.

Пример записи голосования:

    voting:        # список голосований
      - votes:     # голосование
        - 5: 6-10  # за игрока 5 проголосовали с 6 по 10 игроки
        - 7: 1-5   # за игрока 7 проголосовали с 1 по 5 игроки
        crash:     # автокатострофа
          - 5: ... # речь игрока в автокатострофе
          - 7: ...
      - votes:     # повторное голосование
        - 5: 6-10
        - 7: 1-5
        - both: 0 # никто не проголосовал за то, чтобы оба игрока покинули игру

#### Как записывать голоса?
Вот грамматика для голосов:

    # terminals
    DDOT = ':'
    COMMA = ','
    DIGIT = '\d+'
    BOTH = 'both'
    EMPTY = ''
    DASH = '-'

    # grammar rules
    VOTE:
        WHOS DDOT HANDS

    WHOS:
        DIGIT
      | BOTH
      | DIGIT COMMA WHOS

    HANDS:
        DIGIT
      | EMPTY
      | DIGIT DASH DIGIT
      | DIGIT HANDS
      | DIGIT COMMA HANDS

Примеры:

    1,2,3,4: 5-9    # за игроков 1 2 3 и 4 проголосовали живые игроки с 5 по 9

    4: 1 3,9        # за игрока 4 проголосовали 1 3 и 9.

    both: 1-10      # за то чтобы поднять всех игроков в перестрелке
                    # проголосовали все живые игроки

#### Быстрая запись

Если голосование было одно, то допускается записывать все что лежит в **votes** прямо в **voting**, например:

    # Вместо
    voting:
      - votes:
        - 3: 4 5
        - 5: 1-3
        - 6,7: 0   # за 6 и 7 никто не проголосовал
        - 2: 6 7

    # Можно писать
    voting:
      - 3: 4 5
      - 5: 1-3
      - 6,7: 0   # за 6 и 7 никто не проголосовал
      - 2: 6 7

Речи игроков
------------

Речь игрока записывается в одну строку. Для обозначения определенных "фактов" в речи используются следующие символы
* **+4,1**: сказал, что "понравились" 4 и 1, или "поиграет" с 4 и 1, или считает красными 4 и 1.
* **-3,9**: сказал, что "не понравились" 3 и 9, или "не поиграет" c 3 и 9, или считает черными 3 и 9.
* **с5**: "check the 5". Просьба проверить 5-ого игрока.
* **n6**: "I nominate player number 6". Выставление на голосование 6-ого игрока.
* **n6x8**: выставление на голосование 6-ого игрока, просьба отозвать высталенного игрока от 8-ого игрока.
* **d6**: отозвал 6-ого игрока.
* **>10**: "Стреляется игрок номер 10."
* **(1 3,5 | -2)**: "Среди игроков 1 3 и 5 сидят 2 черных игрока."
* **$**: Вскрылся шерифом, не говорит проверок.
* **$++**: Вскрылся шерифом, говорит 2 красные проверки, но не называет какие.
* **$+--**: Вскрылся шерифом, говорит одна красная и две черных, но не называет какие.
* **($ +1 -4,5)**: "Я шериф, проверил в первую ночь 1 красный, во вторую 4 черный, в третью 5 черный."
* **$x** или **($x)**: Отказ от шерифства
* **($$ -10)**: "Я получил маяк, что 10 проверенный черный."
* **($$ -10 | 2)**: "Я получил маяк от игрока номер 2, что 10 проверенный черный."
* **($? (4:x) (5:-1,-3))**: Опрос на шерифство, вскрылись 4 и 5. 4 отказался от шерифства. У 5: 1 и 3 черные проверки.
* **z**: "я не голосуюсь".
* **z7**: "Игрок номер 7 не голосуется".
* **(z10 1 10)** или **(z10 1,10)**: во время речи игрока игрок номер 10 сказал или показал жестом, что 1 и 10 не голосуются.
* **(z?10)**: "Игрок номер 10, у вас есть основания сидеть за столом?"

Пример:
    # речь
    Я поиграю с игрокми 1 и 3. Позиция 3 мне понравилась, а 1 считаю красным по неигровым моментам. Мне не очень нравится, что игрок номер
    7 копает под 1. Выставляю игрока номер 4, уже стоит... Выстовляю игрока номер 7... (игрок номер 7 просит отозвать)... Есть основания игрок номер 7?... Вы шериф, ну хорошо, тогда посидите, я получил маяк, что вы проверенный черный игрок. Я тоже посижу. Пас.

    # запись
    +1,3 -7 n4 n7x7 (z?7) (z7 7) ($$ -7) z
